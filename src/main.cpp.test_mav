#include <Arduino.h>
#include "wiring_private.h" // pinPeripheral() function
#include <Adafruit_NeoPixel.h>
#include <OneWire.h>
#include <DallasTemperature.h>
#include "mavlink/MAVLink.h"
Adafruit_NeoPixel pixels(1, PIN_NEOPIXEL);
OneWire oneWire(3);
DallasTemperature dallasTemp(&oneWire);
DeviceAddress dallasAddr;
Uart Serial2(&sercom2,9,10,SERCOM_RX_PAD_1,UART_TX_PAD_2);
void SERCOM2_Handler()
{
  Serial2.IrqHandler();
}

void setup() {
  pixels.begin();
  pixels.setPixelColor(0,pixels.Color(0,0,255));
  pixels.show();
  delay(200);
  pinPeripheral(9,PIO_SERCOM);
  pinPeripheral(10,PIO_SERCOM);
  Serial1.begin(115200);
  Serial2.begin(4800);
  dallasTemp.begin(); // Dallas temp
  dallasTemp.getAddress(dallasAddr, 0);
  dallasTemp.setWaitForConversion(false);
  dallasTemp.setCheckForConversion(false);
  pixels.setPixelColor(0,pixels.Color(0,255,0));
  pixels.show();
  delay(1000);
}

void loop() {
    mavlink_message_t msg;
  uint8_t buf[MAVLINK_MAX_PACKET_LEN];

  mavlink_msg_heartbeat_pack(1, MAV_COMP_ID_AUTOPILOT1, &msg, MAV_TYPE_QUADROTOR, MAV_AUTOPILOT_GENERIC, MAV_MODE_FLAG_MANUAL_INPUT_ENABLED, 0, MAV_STATE_STANDBY);
  uint16_t len = mavlink_msg_to_send_buffer(buf, &msg);
  Serial2.write(buf, len);
  // Serial2.println("Hello World");
  delay(50);
}